C251 COMPILER V5.60.0,  APP_I2C_PS                                                         26/11/24  21:24:41  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE APP_I2C_PS
OBJECT MODULE PLACED IN .\list\APP_I2C_PS.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE ..\App\src\APP_I2C_PS.c XSMALL INTR2 BROWSE INCDIR(..\Driver\inc;..\Us
                    -er;..\App\inc) DEBUG PRINT(.\list\APP_I2C_PS.lst) TABS(2) OBJECT(.\list\APP_I2C_PS.obj) 

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* --- STC MCU Limited ------------------------------------------------*/
    3          /* --- STC 1T Series MCU Demo Programme -------------------------------*/
    4          /* --- Mobile: (86)13922805190 ----------------------------------------*/
    5          /* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/
    6          /* --- Tel: 86-0513-55012928,55012929,55012966 ------------------------*/
    7          /* --- Web: www.STCMCU.com --------------------------------------------*/
    8          /* --- Web: www.STCMCUDATA.com  ---------------------------------------*/
    9          /* --- QQ:  800003751 -------------------------------------------------*/
   10          /* Èç¹ûÒªÔÚ³ÌÐòÖÐÊ¹ÓÃ´Ë´úÂë,ÇëÔÚ³ÌÐòÖÐ×¢Ã÷Ê¹ÓÃÁËSTCµÄ×ÊÁÏ¼°³ÌÐò            */
   11          /*---------------------------------------------------------------------*/
   12          
   13          #include  "APP.h"
   14          #include  "STC32G_GPIO.h"
   15          #include  "STC32G_I2C.h"
   16          #include  "STC32G_Soft_I2C.h"
   17          #include  "STC32G_NVIC.h"
   18          #include  "STC32G_Switch.h"
   19          
   20          /*************  ¹¦ÄÜËµÃ÷  **************
   21          
   22          ÄÚ²¿¼¯³ÉI2C´®ÐÐ×ÜÏß¿ØÖÆÆ÷×ö´Ó»úÄ£Ê½£¬SCL->P3.2, SDA->P3.3;
   23          IO¿ÚÄ£ÄâI2C×öÖ÷»úÄ£Ê½£¬SCL->P0.0, SDA->P0.1;
   24          Í¨¹ýÍâ²¿·ÉÏßÁ¬½Ó P0.0->P3.2, P0.1->P3.3£¬ÊµÏÖI2C×Ô·¢×ÔÊÕ¹¦ÄÜ¡£
   25          
   26          ÓÃSTCµÄMCUµÄIO·½Ê½Çý¶¯8Î»ÊýÂë¹Ü¡£
   27          Ê¹ÓÃTimer0µÄ16Î»×Ô¶¯ÖØ×°À´²úÉú1ms½ÚÅÄ,³ÌÐòÔËÐÐÓÚÕâ¸ö½ÚÅÄÏÂ,ÓÃ»§ÐÞ¸ÄMCUÖ÷Ê±ÖÓÆµÂÊÊ±,×Ô¶¯¶¨Ê±ÓÚ1ms.
   28          ¼ÆÊýÆ÷Ã¿ÃëÖÓ¼Ó1, ¼ÆÊý·¶Î§Îª0~9999.
   29          
   30          ÏÔÊ¾Ð§¹ûÎª: ÉÏµçºóÖ÷»úÃ¿ÃëÖÓ·¢ËÍÒ»´Î¼ÆÊýÊý¾Ý£¬²¢ÔÚ×ó±ß4¸öÊýÂë¹ÜÉÏÏÔÊ¾·¢ËÍÄÚÈÝ£»´Ó»ú½ÓÊÕµ½Êý¾ÝºóÔÚÓÒ±ß4¸öÊ
             -ýÂë¹ÜÏÔÊ¾¡£
   31          
   32          ÏÂÔØÊ±, Ñ¡ÔñÊ±ÖÓ 24MHz (¿ÉÒÔÔÚÅäÖÃÎÄ¼þ"config.h"ÖÐÐÞ¸Ä).
   33          
   34          ******************************************/
   35          
   36          //========================================================================
   37          //                               ±¾µØ³£Á¿ÉùÃ÷ 
   38          //========================================================================
   39          
   40          
   41          //========================================================================
   42          //                               ±¾µØ±äÁ¿ÉùÃ÷
   43          //========================================================================
   44          
   45          u8  temp[4];     //Í¨ÓÃÊý×é
   46          
   47          //========================================================================
   48          //                               ±¾µØº¯ÊýÉùÃ÷
   49          //========================================================================
   50          
   51          
   52          //========================================================================
   53          //                            Íâ²¿º¯ÊýºÍ±äÁ¿ÉùÃ÷
   54          //========================================================================
   55          
   56          
   57          //========================================================================
C251 COMPILER V5.60.0,  APP_I2C_PS                                                         26/11/24  21:24:41  PAGE 2   

   58          // º¯Êý: I2C_PS_init
   59          // ÃèÊö: ÓÃ»§³õÊ¼»¯³ÌÐò.
   60          // ²ÎÊý: None.
   61          // ·µ»Ø: None.
   62          // °æ±¾: V1.0, 2020-09-25
   63          //========================================================================
   64          void I2C_PS_init(void)
   65          {
   66   1        u8  i;
   67   1        I2C_InitTypeDef   I2C_InitStructure;
   68   1      
   69   1        P0_MODE_IO_PU(GPIO_Pin_0 | GPIO_Pin_1);   //P0.0,P0.1 ÉèÖÃÎª×¼Ë«Ïò¿Ú
   70   1        P3_MODE_IO_PU(GPIO_Pin_3);      //P3.3 ÉèÖÃÎª×¼Ë«Ïò¿Ú
   71   1        P6_MODE_IO_PU(GPIO_Pin_All);    //P6 ÉèÖÃÎª×¼Ë«Ïò¿Ú
   72   1        P7_MODE_IO_PU(GPIO_Pin_All);    //P7 ÉèÖÃÎª×¼Ë«Ïò¿Ú
   73   1        I2C_SW(I2C_P33_P32);          //I2C_P14_P15,I2C_P24_P25,I2C_P76_P77,I2C_P33_P32
   74   1      
   75   1        I2C_InitStructure.I2C_Mode      = I2C_Mode_Slave;   //Ö÷´ÓÑ¡Ôñ   I2C_Mode_Master, I2C_Mode_Slave
   76   1        I2C_InitStructure.I2C_Enable    = ENABLE;           //I2C¹¦ÄÜÊ¹ÄÜ,   ENABLE, DISABLE
   77   1        I2C_InitStructure.I2C_SL_MA     = ENABLE;           //Ê¹ÄÜ´Ó»úµØÖ·±È½Ï¹¦ÄÜ,   ENABLE, DISABLE
   78   1        I2C_InitStructure.I2C_SL_ADR    = 0x2d;             //´Ó»úÉè±¸µØÖ·,  0~127  (0x2d<<1 = 0x5a)
   79   1        I2C_Init(&I2C_InitStructure);
   80   1        NVIC_I2C_Init(I2C_Mode_Slave,I2C_ESTAI|I2C_ERXI|I2C_ETXI|I2C_ESTOI,Priority_0); //Ö÷´ÓÄ£Ê½, I2C_Mode_Mas
             -ter, I2C_Mode_Slave; ÖÐ¶ÏÊ¹ÄÜ, I2C_ESTAI/I2C_ERXI/I2C_ETXI/I2C_ESTOI/DISABLE; ÓÅÏÈ¼¶(µÍµ½¸ß) Priority_0,Priority_1,Prior
             -ity_2,Priority_3
   81   1      
   82   1        display_index = 0;
   83   1        DisplayFlag = 0;
   84   1        for(i=0; i<8; i++)  LED8[i] = 0x10; //ÉÏµçÏûÒþ
   85   1      }
   86          
   87          //========================================================================
   88          // º¯Êý: Sample_I2C_PS
   89          // ÃèÊö: ÓÃ»§Ó¦ÓÃ³ÌÐò.
   90          // ²ÎÊý: None.
   91          // ·µ»Ø: None.
   92          // °æ±¾: V1.0, 2020-09-25
   93          //========================================================================
   94          void Sample_I2C_PS(void)
   95          {
   96   1        DisplayScan();
   97   1        
   98   1        if(DisplayFlag)
   99   1        {
  100   2          DisplayFlag = 0;
  101   2          LED8[4] = I2C_Buffer[0];
  102   2          LED8[5] = I2C_Buffer[1];
  103   2          LED8[6] = I2C_Buffer[2];
  104   2          LED8[7] = I2C_Buffer[3];
  105   2        }
  106   1        
  107   1        if(++msecond >= 1000)   //1Ãëµ½
  108   1        {
  109   2          msecond = 0;        //Çå1000ms¼ÆÊý
  110   2          second++;         //Ãë¼ÆÊý+1
  111   2          if(second >= 200)    second = 0;   //Ãë¼ÆÊý·¶Î§Îª0~199
  112   2      
  113   2          temp[0] = second / 1000;
  114   2          temp[1] = (second % 1000) / 100;
  115   2          temp[2] = (second % 100) / 10;
  116   2          temp[3] = second % 10;
  117   2          LED8[0] = temp[0];
  118   2          LED8[1] = temp[1];
  119   2          LED8[2] = temp[2];
  120   2          LED8[3] = temp[3];
  121   2      
C251 COMPILER V5.60.0,  APP_I2C_PS                                                         26/11/24  21:24:41  PAGE 3   

  122   2          SI2C_WriteNbyte(SLAW, 0, temp, 4);
  123   2        }
  124   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       301     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =         4          6
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
