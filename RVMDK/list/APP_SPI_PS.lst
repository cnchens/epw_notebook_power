C251 COMPILER V5.60.0,  APP_SPI_PS                                                         26/11/24  21:24:42  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE APP_SPI_PS
OBJECT MODULE PLACED IN .\list\APP_SPI_PS.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE ..\App\src\APP_SPI_PS.c XSMALL INTR2 BROWSE INCDIR(..\Driver\inc;..\Us
                    -er;..\App\inc) DEBUG PRINT(.\list\APP_SPI_PS.lst) TABS(2) OBJECT(.\list\APP_SPI_PS.obj) 

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* --- STC MCU Limited ------------------------------------------------*/
    3          /* --- STC 1T Series MCU Demo Programme -------------------------------*/
    4          /* --- Mobile: (86)13922805190 ----------------------------------------*/
    5          /* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/
    6          /* --- Tel: 86-0513-55012928,55012929,55012966 ------------------------*/
    7          /* --- Web: www.STCMCU.com --------------------------------------------*/
    8          /* --- Web: www.STCMCUDATA.com  ---------------------------------------*/
    9          /* --- QQ:  800003751 -------------------------------------------------*/
   10          /* »Áπ˚“™‘⁄≥Ã–Ú÷– π”√¥À¥˙¬Î,«Î‘⁄≥Ã–Ú÷–◊¢√˜ π”√¡ÀSTCµƒ◊ ¡œº∞≥Ã–Ú            */
   11          /*---------------------------------------------------------------------*/
   12          
   13          #include  "APP.h"
   14          #include  "STC32G_GPIO.h"
   15          #include  "STC32G_SPI.h"
   16          #include  "STC32G_UART.h"
   17          #include  "STC32G_NVIC.h"
   18          
   19          /*************  π¶ƒ‹Àµ√˜  **************
   20          
   21          Õ®π˝¥Æø⁄∑¢ÀÕ ˝æ›∏¯MCU1£¨MCU1Ω´Ω” ’µΩµƒ ˝æ›”…SPI∑¢ÀÕ∏¯MCU2£¨MCU2‘ŸÕ®π˝¥Æø⁄∑¢ÀÕ≥ˆ»•.
   22          
   23          …Ë÷√∑Ω∑® 2£∫
   24          ¡Ω∏ˆ…Ë±∏≥ı ºªØ ±∂º…Ë÷√ SSIG Œ™ 0£¨MSTR …Ë÷√Œ™0£¨¥À ±¡Ω∏ˆ…Ë±∏∂º «≤ª∫ˆ¬‘ SS µƒ¥”ª˙ƒ£ Ω°£
   25          µ±∆‰÷–“ª∏ˆ…Ë±∏–Ë“™∆Ù∂Ø¥´ ‰ ±£¨œ»ºÏ≤‚ SS π‹Ω≈µƒµÁ∆Ω£¨»Áπ˚ ±∫Ú∏ﬂµÁ∆Ω£¨
   26          æÕΩ´◊‘º∫…Ë÷√≥…∫ˆ¬‘ SS µƒ÷˜ƒ£ Ω£¨◊‘º∫µƒ SS Ω≈ ‰≥ˆµÕµÁ∆Ω£¨¿≠µÕ∂‘∑Ωµƒ SS Ω≈£¨º¥ø…Ω¯–– ˝æ›¥´ ‰°£
   27          
   28                   MCU1                          MCU2
   29            |-----------------|           |-----------------|
   30            |            MISO |-----------| MISO            |
   31          --| TX         MOSI |-----------| MOSI         TX |--
   32            |            SCLK |-----------| SCLK            |
   33          --| RX           SS |-----------| SS           RX |--
   34            |-----------------|           |-----------------|
   35          
   36          
   37          œ¬‘ÿ ±, —°‘Ò ±÷” 24MHz (ø…“‘‘⁄≈‰÷√Œƒº˛"config.h"÷––ﬁ∏ƒ).
   38          
   39          ******************************************/
   40          
   41          //========================================================================
   42          //                               ±æµÿ≥£¡ø…˘√˜ 
   43          //========================================================================
   44          
   45          
   46          //========================================================================
   47          //                               ±æµÿ±‰¡ø…˘√˜
   48          //========================================================================
   49          
   50          bit UartReceived=0;
   51          
   52          //========================================================================
   53          //                               ±æµÿ∫Ø ˝…˘√˜
   54          //========================================================================
   55          
   56          
   57          //========================================================================
   58          //                            Õ‚≤ø∫Ø ˝∫Õ±‰¡ø…˘√˜
C251 COMPILER V5.60.0,  APP_SPI_PS                                                         26/11/24  21:24:42  PAGE 2   

   59          //========================================================================
   60          
   61          
   62          //========================================================================
   63          // ∫Ø ˝: SPI_PS_init
   64          // √Ë ˆ: ”√ªß≥ı ºªØ≥Ã–Ú.
   65          // ≤Œ ˝: None.
   66          // ∑µªÿ: None.
   67          // ∞Ê±æ: V1.0, 2020-09-27
   68          //========================================================================
   69          void SPI_PS_init(void)
   70          {
   71   1        SPI_InitTypeDef   SPI_InitStructure;
   72   1        COMx_InitDefine   COMx_InitStructure;         //Ω·ππ∂®“Â
   73   1      
   74   1        COMx_InitStructure.UART_Mode      = UART_8bit_BRTx;   //ƒ£ Ω,   UART_ShiftRight,UART_8bit_BRTx,UART_9bit,
             -UART_9bit_BRTx
   75   1      //  COMx_InitStructure.UART_BRT_Use   = BRT_Timer2;     //—°‘Ò≤®Ãÿ¬ ∑¢…˙∆˜, BRT_Timer2 (◊¢“‚: ¥Æø⁄2πÃ∂® π”√B
             -RT_Timer2, À˘“‘≤ª”√—°‘Ò)
   76   1        COMx_InitStructure.UART_BaudRate  = 115200ul;     //≤®Ãÿ¬ ,     110 ~ 115200
   77   1        COMx_InitStructure.UART_RxEnable  = ENABLE;       //Ω” ’‘ –Ì,   ENABLE ªÚ DISABLE
   78   1        UART_Configuration(UART2, &COMx_InitStructure);   //≥ı ºªØ¥Æø⁄2 UART1,UART2,UART3,UART4
   79   1        NVIC_UART2_Init(ENABLE,Priority_1);   //÷–∂œ πƒ‹, ENABLE/DISABLE; ”≈œ»º∂(µÕµΩ∏ﬂ) Priority_0,Priority_1,Pr
             -iority_2,Priority_3
   80   1      
   81   1        SPI_InitStructure.SPI_Enable    = ENABLE;       //SPI∆Ù∂Ø    ENABLE, DISABLE
   82   1        SPI_InitStructure.SPI_SSIG      = DISABLE;        //∆¨—°Œª     ENABLE(∫ˆ¬‘SS“˝Ω≈π¶ƒ‹), DISABLE(SS»∑∂®÷˜ª˙¥”ª
             -˙)
   83   1        SPI_InitStructure.SPI_FirstBit  = SPI_MSB;        //“∆Œª∑ΩœÚ   SPI_MSB, SPI_LSB
   84   1        SPI_InitStructure.SPI_Mode      = SPI_Mode_Slave;   //÷˜¥”—°‘Ò   SPI_Mode_Master, SPI_Mode_Slave
   85   1        SPI_InitStructure.SPI_CPOL      = SPI_CPOL_Low;     // ±÷”œ‡Œª   SPI_CPOL_High,   SPI_CPOL_Low
   86   1        SPI_InitStructure.SPI_CPHA      = SPI_CPHA_2Edge;   // ˝æ›±ﬂ—ÿ   SPI_CPHA_1Edge,  SPI_CPHA_2Edge
   87   1        SPI_InitStructure.SPI_Speed     = SPI_Speed_4;      //SPIÀŸ∂»    SPI_Speed_4, SPI_Speed_8, SPI_Speed_16, SP
             -I_Speed_2
   88   1        SPI_Init(&SPI_InitStructure);
   89   1        NVIC_SPI_Init(ENABLE,Priority_3);   //÷–∂œ πƒ‹, ENABLE/DISABLE; ”≈œ»º∂(µÕµΩ∏ﬂ) Priority_0,Priority_1,Prio
             -rity_2,Priority_3
   90   1      
   91   1        P2_MODE_IO_PU(GPIO_Pin_All);    //P2 …Ë÷√Œ™◊ºÀ´œÚø⁄
   92   1        P4_MODE_IO_PU(GPIO_Pin_6 | GPIO_Pin_7);   //P4.6,P4.7 …Ë÷√Œ™◊ºÀ´œÚø⁄
   93   1      
   94   1        SPI_SS_2 = 1;
   95   1      }
   96          
   97          //========================================================================
   98          // ∫Ø ˝: Sample_SPI_PS
   99          // √Ë ˆ: ”√ªß”¶”√≥Ã–Ú.
  100          // ≤Œ ˝: None.
  101          // ∑µªÿ: None.
  102          // ∞Ê±æ: V1.0, 2020-09-27
  103          //========================================================================
  104          void Sample_SPI_PS(void)
  105          {
  106   1        u8 i;
  107   1        
  108   1        if(COM2.RX_TimeOut > 0)
  109   1        {
  110   2          if(--COM2.RX_TimeOut == 0)
  111   2          {
  112   3            if(COM2.RX_Cnt > 0)
  113   3            {
  114   4              UartReceived = 1;   //…Ë÷√¥Æø⁄Ω” ’±Í÷æ
  115   4            }
  116   3          }
  117   2        }
  118   1        if((UartReceived) && (SPI_SS_2))
C251 COMPILER V5.60.0,  APP_SPI_PS                                                         26/11/24  21:24:42  PAGE 3   

  119   1        {
  120   2          SPI_SS_2 = 0;     //¿≠µÕ¥”ª˙ SS π‹Ω≈
  121   2          SPI_SetMode(SPI_Mode_Master);
  122   2          for(i=0;i<COM2.RX_Cnt;i++)
  123   2          {
  124   3            SPI_WriteByte(RX2_Buffer[i]); //∑¢ÀÕ¥Æø⁄ ˝æ›
  125   3          }
  126   2          SPI_SS_2 = 1;    //¿≠∏ﬂ¥”ª˙µƒ SS π‹Ω≈
  127   2          SPI_SetMode(SPI_Mode_Slave);
  128   2          COM2.RX_Cnt = 0;
  129   2          UartReceived = 0;
  130   2        }
  131   1        
  132   1        if(SPI_RxTimerOut > 0)
  133   1        {
  134   2          if(--SPI_RxTimerOut == 0)
  135   2          {
  136   3            if(SPI_RxCnt > 0)
  137   3            {
  138   4              for(i=0; i<SPI_RxCnt; i++)  TX2_write2buff(SPI_RxBuffer[i]);
  139   4            }
  140   3            SPI_RxCnt = 0;
  141   3          }
  142   2        }
  143   1      }
  144          
  145          
  146          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       241     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------         16
  bit size             =         1     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
